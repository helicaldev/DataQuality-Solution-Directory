<script src="/pcni/js/project/jquery.dynatable.js"></script>
<script src="/pcni/js/project/c3.js"></script>
<script src="/pcni/js/project/dp_test.js"></script>
<link rel="stylesheet" type="text/css" href="/pcni/css/project/c3.css">
<style type="text/css">
th a {
  color: #fff;
}
th a:hover {
  color: #fff;
  text-decoration: underline;
}

.dynatable-search {
  float: right;
  margin-bottom: 10px;
}

.dynatable-pagination-links {
  float: right;
}

.dynatable-record-count {
  display: block;
  padding: 5px 0;
}

.dynatable-pagination-links span,
.dynatable-pagination-links li {
  display: inline-block;
}

.dynatable-page-link,
.dynatable-page-break {
  display: block;
  padding: 5px 7px;
}

.dynatable-page-link {
  cursor: pointer;
}

.dynatable-active-page,
.dynatable-disabled-page {
  cursor: text;
}
.dynatable-active-page:hover,
.dynatable-disabled-page:hover {
  text-decoration: none;
}

.dynatable-active-page {
  background: #71AF5A;
  border-radius: 5px;
  color: #fff;
}
.dynatable-active-page:hover {
  color: #fff;
}
.dynatable-disabled-page,
.dynatable-disabled-page:hover {
  background: none;
  color: #999;
}
th a {
  color: #fff;
}
th a:hover {
  color: #fff;
  text-decoration: underline;
}

.dynatable-search {
  float: right;
  margin-bottom: 10px;
}

.dynatable-pagination-links {
  float: right;
}

.dynatable-record-count {
  display: block;
  padding: 5px 0;
}

.dynatable-pagination-links span,
.dynatable-pagination-links li {
  display: inline-block;
}

.dynatable-page-link,
.dynatable-page-break {
  display: block;
  padding: 5px 7px;
}

.dynatable-page-link {
  cursor: pointer;
}

.dynatable-active-page,
.dynatable-disabled-page {
  cursor: text;
}
.dynatable-active-page:hover,
.dynatable-disabled-page:hover {
  text-decoration: none;
}

.dynatable-active-page {
  background: #71AF5A;
  border-radius: 5px;
  color: #fff;
}
.dynatable-active-page:hover {
  color: #fff;
}
.dynatable-disabled-page,
.dynatable-disabled-page:hover {
  background: none;
  color: #999;
}

.dynatable-head {
        background-color: #cccccc;
}

svg{
        cursor: pointer;
}


.bar {
    fill: #c0c0c0;

}


.btn-success {
        background-color: #e6e6e6;
        border-color: black;
        color: black;
}
.btn-success.active,
.btn-success:active,
.btn-success:focus,
.btn-success.hover,
.open >
.dropdown-
toggle.btn-success {
 background-color: #e6e6e6;
 border-color:black;
 color: black;
 }

.btn-hover {
background-color:#e6e6e6;
}

.form-control {
    border-color:black;
}

#chart_4 {
    border-color:black;
    border:none;
}
#chart_5 {
    border-color:black;
    border:none;
}
.panel > .table-bordered > tbody > tr:first-child > td, .panel > .table-bordered > tbody > tr:first-child > th, .panel > .table-bordered > tbody > tr:last-child > td, .panel > .table-bordered > tbody > tr:last-child > th, .panel > .table-bordered > tfoot > tr:last-child > td, .panel > .table-bordered > tfoot > tr:last-child > th, .panel > .table-bordered > thead > tr:first-child > td, .panel > .table-bordered > thead > tr:first-child > th, .panel > .table-responsive > .table-bordered > tbody > tr:first-child > td, .panel > .table-responsive > .table-bordered > tbody > tr:first-child > th, .panel > .table-responsive > .table-bordered > tbody > tr:last-child > td, .panel > .table-responsive > .table-bordered > tbody > tr:last-child > th, .panel > .table-responsive > .table-bordered > tfoot > tr:last-child > td, .panel > .table-responsive > .table-bordered > tfoot > tr:last-child > th, .panel > .table-responsive > .table-bordered > thead > tr:first-child > td, .panel > .table-responsive > .table-bordered > thead > tr:first-child > th {
        border-bottom: 1px solid;
        border-right: 1px solid;
        border-left:1px solid;
        border-top:1px solid;
}


.dynatable-sort-header {
color:black;
}

.table-striped > tbody > tr:nth-child(2n+1) > td, .table-striped > tbody > tr:nth-child(2n+1) > th {
        background-color: white;
}


.panel > .table-bordered > tbody > tr > td:last-child, .panel > .table-bordered > tbody > tr > th:last-child, .panel > .table-bordered > tfoot > tr > td:last-child, .panel > .table-bordered > tfoot > tr > th:last-child, .panel > .table-bordered > thead > tr > td:last-child, .panel > .table-bordered > thead > tr > th:last-child, .panel > .table-responsive > .table-bordered > tbody > tr > td:last-child, .panel > .table-responsive > .table-bordered > tbody > tr > th:last-child, .panel > .table-responsive > .table-bordered > tfoot > tr > td:last-child, .panel > .table-responsive > .table-bordered > tfoot > tr > th:last-child, .panel > .table-responsive > .table-bordered > thead > tr > td:last-child, .panel > .table-responsive > .table-bordered > thead > tr > th:last-child {
        border-right: 1px solid;
}

.panel > .table-bordered > tbody > tr > td:first-child, .panel > .table-bordered > tbody > tr > th:first-child, .panel > .table-bordered > tfoot > tr > td:first-child, .panel > .table-bordered > tfoot > tr > th:first-child, .panel > .table-bordered > thead > tr > td:first-child, .panel > .table-bordered > thead > tr > th:first-child, .panel > .table-responsive > .table-bordered > tbody > tr > td:first-child, .panel > .table-responsive > .table-bordered > tbody > tr > th:first-child, .panel > .table-responsive > .table-bordered > tfoot > tr > td:first-child, .panel > .table-responsive > .table-bordered > tfoot > tr > th:first-child, .panel > .table-responsive > .table-bordered > thead > tr > td:first-child, .panel > .table-responsive > .table-bordered > thead > tr > th:first-child {
        border-left: 1px solid;
}
.table-striped > tbody > tr:nth-child(2n+1) > td, .table-striped > tbody > tr:nth-child(2n+1) > th {
        background-color: white;
        border: 1px solid;
}
.table-striped > tbody > tr:nth-child(2n+1) > td, .table-striped > tbody > tr:nth-child(2n+1) > th {
        background-color: #f9f9f9;
}

.table-bordered, .table-bordered > tbody > tr > td, .table-bordered > tbody > tr > th, .table-bordered > tfoot > tr > td, .table-bordered > tfoot > tr > th, .table-bordered > thead > tr > td, .table-bordered > thead > tr > th {
        border: 1px solid;
}

.block{
    display: block;
    width: 100%;
    color: #000;
    font-size: 32px;
    text-align: center;
}

.text-padding{
    padding: 10px;
}

.text-left{
    text-align: left !important;
}

#scheduleBtn {
    background:#e6e6e6;
    border-color:black;
    color:black;
}

.selectpicker {
    border-color:black;
}

.modal-body {
    position: relative;
    overflow-y: auto;
    max-height: 400px;
    padding: 15px;
}

#projectSelector ul {
    padding: 0;
    margin: 0;
    list-style: none;
}

#toolbar div{
    text-align: center;
}

#toolbar a{
    color: #222;
}

#tb-convert-to-charts.disabled{
    color: #aaa;
}

@media print{
  .alert-info, .dynatable-per-page, .dynatable-search{
    display: none !important;
  }

  .breadcrumb a {
    color: #222;
  }
}

@media screen{
    #projectSelector li:nth-child(n+3){
        display: none;
    }
}

</style>
<div id="custom_dummytag"/>
<div id="custom_dummytag1"/>
<div class="container">
    <div class="row">
        <ol class="breadcrumb">
            <li id="back"><a href="#">Template</a></li>
            <li id="main-report" class="hidden"><a href="#">Main Report</a></li>
            <li id="drilldown-report" class="hidden">Drilldown Report</li>
			<li id="drilldown-report-all" class="hidden">Get All Info</li>
        </ol>
    </div>
    <div class="row">
        <!-- <h3 class="bg-success text-padding"><span class="fa fa-bar-chart-o"></span> New Report
  <span class="fa fa-arrow-left hidden-print" id="back"></span></h3>
    </div> -->
    <div class="row hidden-print" style="display: none;" id="toolbar">
        <div class="dropdown col-xs-2">
              <button type="button" data-toggle="dropdown" class="btn btn-default" style="border:none;">
                <span class="fa fa-download fa-2x"></span>
                <span class="caret"></span>
              </button>
                <ul class="dropdown-menu" role="menu" id="tb-export">
                    <li><a href="#" data-format="pdf">Export PDF</a></li>
                    <li><a href="#" data-format="csv">Export CSV</a></li>
                </ul>
            </div>
        <div class="col-xs-2">
            <a href="#" id="tb-save"><span class="fa fa-floppy-o  fa-2x"></span></a>
        </div>
        <div class="col-xs-2">
            <a href="#" id="tb-print-pdf"><span class="fa fa-print fa-2x"></span></a>
        </div>
        <div class="col-xs-2">
            <a href="#" id="tb-convert-to-charts">
                <span class="fa fa-bar-chart-o fa-2x"></span>
            </a>
        </div>
        <div class="col-xs-2">
            <a href="#" id="tb-email">
                <span class="fa fa-envelope fa-2x"></span>
            </a>
        </div>
        <div class="col-xs-2">
            <a href="#">
                <span id="favSelection" class="fa fa-star-o fa-2x"></span>
            </a>
        </div>
    </div>
    <div class="row" style="display:none;" id = "info">
        <div class="col-sm-6">
            <div class="form-horizontal">
                <div class="form-group">
                    <label class="col-xs-4">Run Date :</label>
                    <label class="col-xs-8" id="runDate"></label>
                </div>
                <div class="form-group">
                    <label class="col-xs-4">Run By :</label>
                    <label class="col-xs-8" id = "runBy"></label>
                </div>
                <div class="form-group">
                    <label class="col-xs-4">Reporting Period :</label>
                    <label class="col-xs-8" id = "reportingPeriod"></label>
                </div>
            </div>
        </div>
        <div class="col-sm-6">
            <div class="form-horizontal">
                <div class="form-group">
                    <label class="col-xs-4">Project Selection(s):</label>
                    <div class="col-xs-8" id="projectSelector">
                        <ul></ul>
                        <a href="#" class="hidden-print">More</a>
                    </div>
                </div>
				<div class="form-group">
                    <label class="col-xs-4"></label>
					<label class="col-xs-8"></label>
            </div>
			<div class="form-group">
                    <label class="col-xs-4" id = "getAllInfo" style="color:#878bd2;text-decoration:underline;">Get All Information</label>
					<label class="col-xs-8"></label>
            </div>
            </div>
        </div>
    </div>
    <div class="row" id="wrap1" data-target="#clientAttr"></div>
	<div class="row" id="total_count"></div>
    <div class="row" id="wrap2"></div>
    <div class="row" id="c3chart"></div>
    <div class="row" id="drill"></div>
	<div class="row" id="wrap3"></div>
    <div class="row" id="wrap">
        <h4>Template : Program Information</h4>
		
        <div class="form-horizontal">
		<form id="DQForm">
            <div class="form-group">
                <label class="col-sm-2 control-label text-left">Agency/Group :</label>
                <div class="col-sm-10" id="agency"></div>
            </div>
			
            <div class="form-group">
                <label class="col-sm-2 control-label text-left">Project :</label>
                <div class="col-sm-10" id="project"></div>
            </div>
			<div class="form-group">
                <label class="col-sm-2 control-label text-left">Project Type:</label>
                <div class="col-sm-10" id="projectType"></div>
            </div>
            <div class="form-group">
                <label class="col-sm-2 control-label text-left">Date Range :</label>
                <label class="col-sm-1 control-label">Start</label>
                <div class="col-sm-4" id="startDate"></div>
                <label class="col-sm-1 control-label">to End</label>
                <div class="col-sm-4" id="endDate"></div>
            </div>
			<div class="form-group">
                <label class="col-sm-2 control-label text-left">Client Location:</label>
                <div class="col-sm-10" id="clientLocation"></div>
            </div>
			<div class="form-group">
                <label class="col-sm-2 control-label text-left">Data Elements Groups:</label>
                <div class="col-sm-10" id="dataElementsGrps"></div>
            </div>
            <div class="form-group">
                <label class="col-sm-2 control-label text-left">Data Elements :</label>
                <div class="col-sm-10" id="dataElements"></div>
            </div>
            <div class="form-group">
                <label class="col-sm-2 control-label text-left">Result Options :</label>
                <div class="col-sm-10" id="resultOptions"></div>
            </div>
            <div class="form-group">
                <div class="col-sm-3 col-sm-offset-9" id="run"></div>
            </div>
            <div class="form-group">
                <div class="col-sm-3" id="save"></div>
            </div>
			</form>
        </div>
		
    </div>
	
</div>
<!--  scheduling - modal-->
<div class="modal fade" id="clientAttr" tabindex="-1" role="dialog" aria-labelledby="drillDownModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title" id="drillDownModalLabel">Client Attributes For Drill Down Output</h4>
      </div>
      <div class="modal-body">
        <div class="form-group">
            <div class="col-xs-12" id="clientAttrPopup"></div>
         </div>
      </div>
      <div class="modal-footer">
        <div class="form-group">
        <div id="runDrillDown" class="col-sm-3 col-sm-offset-9"></div>
        </div>
    </div>
  </div>
</div>
</div>

<div class="modal fade" id="clientAttr_all" tabindex="-1" role="dialog" aria-labelledby="drillDownModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title" id="drillDownModalLabel">Client Attributes For Drill Down Output</h4>
      </div>
      <div class="modal-body">
        <div class="form-group">
            <div class="col-xs-12" id="clientAttrPopup_all"></div>
         </div>
      </div>
      <div class="modal-footer">
        <div class="form-group">
        <div id="runDrillDown_all" class="col-sm-3 col-sm-offset-9"></div>
        </div>
    </div>
  </div>
</div>
</div>

<div class="modal fade" id="saveModal" class="" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	 <div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h4 class="modal-title" id="modalTitle">Please give a name and description for your report</h4>
			</div>
			<div class="modal-body">
				<div class="form-group">
					 <div class="col-sm-12">
                            <input type="text" class="form-control" id="nameReport" name="nameReport" placeholder = "Enter name">
                     </div>
					 <div class = "col-sm-12"></div>
					 <div class="col-sm-12">
                             <input type="text" class="form-control" maxlength="100" id="descReport" name="descReport" placeholder = "Enter Description">
                     </div>
				</div>
			</div>
			<div class="modal-footer">
				<div class="form-group">
					<div id="modal_submit" class="col-sm-3 col-sm-offset-9"></div>
				</div>
			</div>
		</div>
	</div>
</div>

<div id="queryResult"></div>

<script>
 var dashboard = Dashboard;
        dashboard.resetAll();
        dashboard.setVariable('DYNATABLE','');
        //dashboard.setVariable('sDate','2013-12-16');
        //dashboard.setVariable('eDate','2014-06-16');
        //dashboard.setVariable('dataelements',['Race','Gender','Ethnicity']);
        //dashboard.setVariable('RESULTOPTIONS',['Missing','Refused']);
        dashboard.setVariable('scheduleSDate','2013-12-16');
        dashboard.setVariable('scheduleEDate','2014-06-16');
        dashboard.setVariable('baseChart',[]);
        dashboard.setVariable('run_now','false');
        dashboard.setVariable('run_now_drillDown','false');
        dashboard.setVariable('drillDown','false');
		dashboard.setVariable('run_now_drillDown_all','false');
		dashboard.setVariable('drillDown_all','false');
		dashboard.setVariable('hide_result','false');
        dashboard.setVariable('recipients',[]);
		dashboard.setVariable('uid',"'"+window.DashboardGlobals.sessionUserName+"'");
		console.log(dashboard.getVariable('uid'));
        var f = "${format}";
		var reportDesc;

         if(f.indexOf("{format}") >= 0){
          dashboard.setVariable('format',[]);
         }
         else{
          dashboard.setVariable('format',f.replace(/'/g,'').split(','));
         }

         var p = "${projectParam}";

         if(p.indexOf("{projectParam}") >= 0){
          dashboard.setVariable('projectParam',[]);
         }
         else{
          dashboard.setVariable('projectParam',p.replace(/'/g,'').split(','));
         }

         var schedule = "${scheduleopts}";

         if(schedule.indexOf("{scheduleopts}") >= 0){
          dashboard.setVariable('scheduleopts',[]);
         }
         else{
          dashboard.setVariable('scheduleopts',schedule.replace(/'/g,'').split(','));
         }

         var emailScheduling = "${emailsettings}";

         if(emailScheduling.indexOf("{emailsettings}") >= 0){
          dashboard.setVariable('emailsettings',[]);
         }
         else{
          dashboard.setVariable('emailsettings',emailScheduling.replace(/'/g,'').split(','));
         }

        var dataElement = "${dataelements}";

         if(dataElement.indexOf("{dataelements}") >= 0){
          dashboard.setVariable('dataelements',['Race','Gender','Ethnicity']);
         }
         else{
          dashboard.setVariable('dataelements',dataElement.replace(/'/g,'').split(','));
         }

         var resultOption = "${RESULTOPTIONS}";

         if(resultOption.indexOf("{RESULTOPTIONS}") >= 0){
          dashboard.setVariable('RESULTOPTIONS',['Missing','Refused']);
         }
         else{
          dashboard.setVariable('RESULTOPTIONS',resultOption.replace(/'/g,'').split(','));
         }

         var agency_key = "${Akey}";

         if(agency_key.indexOf("{Akey}") >= 0){
          dashboard.setVariable('Akey',['960']);
         }
         else{
          dashboard.setVariable('Akey',agency_key.replace(/'/g,'').split(','));
         }
		 
		 var agency_key_1 = "${Akey_1}";

         if(agency_key_1.indexOf("{Akey_1}") >= 0){
          dashboard.setVariable('Akey_1',['82']);
         }
         else{
          dashboard.setVariable('Akey_!',agency_key_1.replace(/'/g,'').split(','));
         }
		 
		var coc_location = "${coc}";

         if(coc_location.indexOf("{coc}") >= 0){
          dashboard.setVariable('coc',['1']);
         }
         else{
          dashboard.setVariable('coc',coc_location.replace(/'/g,'').split(','));
         }
		 
		 var prj_type = "${CODE_KEY}";

         if(prj_type.indexOf("{CODE_KEY}") >= 0){
          dashboard.setVariable('CODE_KEY',['1']);
         }
         else{
          dashboard.setVariable('CODE_KEY',prj_type.replace(/'/g,'').split(','));
         }

		 
		 var dataElemGroup = "${did}";

         if(dataElemGroup.indexOf("{did}") >= 0){
          dashboard.setVariable('did',['1']);
         }
         else{
          dashboard.setVariable('did',dataElemGroup.replace(/'/g,'').split(','));
         }
		 
		 var dataElemGroup_1 = "${did_1}";

         if(dataElemGroup_1.indexOf("{did_1}") >= 0){
          dashboard.setVariable('did_1',['1']);
         }
         else{
          dashboard.setVariable('did_1',dataElemGroup_1.replace(/'/g,'').split(','));
         }


         var Project_Key = "${PKey}";

         if(Project_Key.indexOf("{PKey}") >= 0){
          dashboard.setVariable('PKey',['3172']);
         }
         else{
          dashboard.setVariable('PKey',Project_Key.replace(/'/g,'').split(','));
         }
		 
		 var Project_Key_1 = "${PKey_1}";

         if(Project_Key.indexOf("{PKey_1}") >= 0){
          dashboard.setVariable('PKey_1',['3172']);
         }
         else{
          dashboard.setVariable('PKey_1',Project_Key_1.replace(/'/g,'').split(','));
         }
		 
		 var Result_key = "${Rkey}";
		if(Result_key.indexOf("{Rkey}") >= 0){
          dashboard.setVariable('Rkey',['Missing','Refused']);
         }
         else{
          dashboard.setVariable('Rkey',Result_key.replace(/'/g,'').split(','));
         }
		 
		 var Result_option = "${result_option}";
		if(Result_option.indexOf("{result_option}") >= 0){
          dashboard.setVariable('result_option',['Missing','Refused']);
         }
         else{
          dashboard.setVariable('result_option',Result_option.replace(/'/g,'').split(','));
         }

         var startDate = "${sDate}";

         if(startDate.indexOf("{sDate}") >= 0){
          dashboard.setVariable('sDate','2011-01-01');
         }
         else{
          dashboard.setVariable('sDate',startDate.replace(/'/g,''));
         }

         var endDate = "${eDate}";

         if(endDate.indexOf("{eDate}") >= 0){
          dashboard.setVariable('eDate','2012-12-31');
         }
         else{
          dashboard.setVariable('eDate',endDate.replace(/'/g,''));
         }

         var ClientAttribute = "${cdisplay}";

         if(ClientAttribute.indexOf("{cdisplay}") >= 0){
          dashboard.setVariable('cdisplay','Client Key');
         }
         else{
          dashboard.setVariable('cdisplay',ClientAttribute.replace(/'/g,'').split(','));
         }
		 
		 var ClientAttribute_org = "${cdisplay_org}";

         if(ClientAttribute_org.indexOf("{cdisplay_org}") >= 0){
          dashboard.setVariable('cdisplay_org','Client Key');
         }
         else{
          dashboard.setVariable('cdisplay_org',ClientAttribute_org.replace(/'/g,'').split(','));
         }
		 
		 var ClientAttribute_org_all = "${cdisplay_org_all}";

         if(ClientAttribute_org_all.indexOf("{cdisplay_org_all}") >= 0){
          dashboard.setVariable('cdisplay_org_all','Client Key');
         }
         else{
          dashboard.setVariable('cdisplay_org_all',ClientAttribute_org_all.replace(/'/g,'').split(','));
         }
		 
		 var ClientAttributeTest = "${clientattr}";

         if(ClientAttributeTest.indexOf("{clientattr}") >= 0){
          dashboard.setVariable('clientattr','Client Key');
         }
         else{
          dashboard.setVariable('clientattr',ClientAttributeTest.replace(/'/g,'').split(','));
         }
		 
		 var ClientAttribute_all = "${cdisplay_all}";

         if(ClientAttribute_all.indexOf("{cdisplay_all}") >= 0){
          dashboard.setVariable('cdisplay_all','Client Key');
         }
         else{
          dashboard.setVariable('cdisplay_all',ClientAttribute_all.replace(/'/g,'').split(','));
         }

         var row = "${rowHeader}";
         if(row.indexOf("{rowHeader}") >= 0){
          dashboard.setVariable('rowHeader','');
         }
         else{
          dashboard.setVariable('rowHeader',row.replace(/'/g,''));
         }

         var col = "${colHeader}";

         if(col.indexOf("{colHeader}") >= 0){
          dashboard.setVariable('colHeader','');
         }
         else{
          dashboard.setVariable('colHeader',col.replace(/'/g,''));
         }

        var projectNames = "${projectNames}";
        if(projectNames.indexOf("{projectNames}") >= 0){
            dashboard.setVariable('projectNames',[]);
            projectNames = false;
        } else {
            projectNames = projectNames.replace(/'/g,'').split(',');
            dashboard.setVariable('projectNames',projectNames);
       }

var selectProjectName = {
    name: "selectProjectName",
    type:  "select2",
    parameters:["PKey"],
    listeners:["Akey"],
    options:{
        multiple:true,
        value : 'PKEY',
        display : 'PROJECT',
        placeholder: 'Select Project'
    },
    requestParameters:{
    Akey:"Akey",
	Akey_1:"Akey"
    },
    htmlElementId : "#project",
    executeAtStart: true,
    map:13
};

var selectAgencyName = {
    name: "selectAgencyName",
    type:  "select2",
    parameters:["Akey"],
	listeners:["uid"],
    options:{
        multiple:true,
        value : 'AKEY',
        display : 'AGENCY',
        placeholder: 'Select Agency'
    },
	requestParameters:{
	uid:"uid"
	},
    htmlElementId : "#agency",
    executeAtStart: true,
    map:12,
    iframe:true
};

var selectProjType = {
    name: "selectProjType",
    type:  "select2",
    parameters:["CODE_KEY"],
	listeners:["PKey"],
    options:{
        multiple:true,
        value : 'CODE_KEY',
        display : 'SHORT_DESC',
        placeholder: 'Select Project Type'
    },
	requestParameters: {
	PKey:"PKey",
	PKey_1:"PKey"
	},
    htmlElementId : "#projectType",
    executeAtStart: true,
    map:10,
    iframe:true
};

var selectClientLoc = {
    name: "selectClientLoc",
    type:  "select2",
    parameters:["coc"],
	listeners : ["PKey"],
    options:{
        multiple:true,
        value : 'COC_KEY',
        display : 'COC_LOCATION',
        placeholder: 'Select Client Location'
    },
	requestParameters : {
	PKey:"PKey",
	PKey_1:"PKey"
	},
    htmlElementId : "#clientLocation",
    executeAtStart: true,
    map:11,
    iframe:true
};

var selectDataElementsGroups = {
    name: "selectDataElementsGroups",
    type:  "select2",
    parameters : ["did"],
    options:{
        multiple:true,
        value : 'DID',
        display : 'DGROUP'
    },
    htmlElementId : "#dataElementsGrps",
    executeAtStart: true,
    map:9,
};

var selectDataElements = {
    name: "selectDataElements",
    type:  "select2",
    parameters : ["dataelements"],
	listeners:["did"],
    options:{
        multiple:true,
        value : 'DATAELEMENTS',
        display : 'DATAELEMENTS'
    },
	requestParameters:{
    did:"did",
	did_1:"did"
    },
    htmlElementId : "#dataElements",
    executeAtStart: true,
    map:14
};

var selectResultOption = {
    name: "selectResultOption",
    type:  "select2",
    parameters :["Rkey"],
    options:{
        multiple:true,
        value : 'RKEY',
        display : 'RESULTOPTIONS',
    },
    htmlElementId : "#resultOptions",
    executeAtStart: true,
    map:15
};

var getResultOption = {
    name: "getResultOption",
    type: "custom",
    listeners: ["Rkey"],
    htmlElementId: "#custom_dummytag",
    customScript: function(a,b) {
        //console.log('----- Executing custom script ---- run_now = ' + dashboard.getVariable('run_now'));
        var a = dashboard.getVariable('Rkey');
			if (a.indexOf("ALL") > -1)
			{
			  a = ["Dont Know","Refused","Missing"];
			}
			else 
			{
			  a = dashboard.getVariable('Rkey');
			}
			Dashboard.setVariable('result_option',a);
			//alert(Rkey);
    },
    executeAtStart: false
};

var dynaTable = {
    name: "dynaTable",
    type:"chart",
    requestParameters :{
        Akey: "Akey",
        PKey : "PKey",
		CODE_KEY:"CODE_KEY",
		coc:"coc",
		dataelements : "dataelements",
        result_option : "result_option",
        sDate : "sDate",
        eDate : "eDate"
    },
	map: 19,
    htmlElementId : "#wrap1",
    executeAtStart: false,
	customScript: function(data)
	{
			if(_.pluck(data, 'one')==1)
			{
					$('#wrap1').html("<div style='border:1px solid;'><h2 style='text-align:CENTER;color:#927333;'>No Data To Display</h2></div>");
					return;
		
			}
			else {
					var drillDown = dashboard.setVariable('drillDown','false');
						var data2 = [];
						for(var i = 0; i< data.length; i++){
							var temp={};
							for (var key in data[i]){
								if( data[i].hasOwnProperty(key)) {
									temp[key.toLowerCase()] = data[i][key];
								}
							}
							data2.push(temp);
						}
			  
					  data = data2;
					  delete data2;
					 
					 
						$("#wrap1").addClass('panel').addClass('panel-primary');
						
						var table = $('<table id="chart_4_table" class="table table-bordered table-striped" "style=background-border:black;"><thead><tr></tr></thead><tbody></tbody></table>');
							
							
						var columns1 = Dashboard.getVariable("result_option");
						
						var temp = columns1.toString(); 
						temp = temp.replace(/'/g,'');

						temp = temp.split(',');

					    var columns = ['dataelements'].concat(temp);
						
						for (var i = 0; i<columns.length; i++){
							table.find('thead tr').append('<th>' + columns[i] + '</th>');
						}               

						$('#wrap1').append(table);

						var dynatable = $('#chart_4_table').dynatable({
						  table :{
							defaultColumnIdStyle : 'lowercase'
						  },
						  dataset: {
							records: data
						  },features: {
							pushState: false
						  },
						})
						.data('dynatable');


						$("#toolbar").removeClass('hidden');

							$('#chart_4_table').find('td').each(function(){
								var elem = $(this);
								if( elem.is(':first-child') || elem.text() === '0' ) return; 
								elem.css( {"text-decoration" : "underline", "cursor" : "pointer"}); 
							});
						
						$('#chart_4_table').on('click', 'td',function () {
					  
						   console.log($(this).html());
						   if($(this).html()!='0') {
								var row = $(this).closest("tr").find("td:first").text();
								console.log(row);
								var indx = $(this).index();
								var col = $('#chart_4_table th').eq(indx).text();
								console.log(col);
							
								$("#selectClientAttr").removeClass('hidden');
								$('#clientAttr').modal('show');
								dashboard.setVariable('rowHeader',row);
								dashboard.setVariable('colHeader',col);
						   }
						   return false;
						});
         }
	}
};

var total_count = {
    name: "total_count",
    type:"chart",
	listeners : ["run_now"],
    requestParameters :{
        Akey: "Akey",
		Akey_1:"Akey",
        PKey : "PKey",
		PKey_1 : "PKey",
    },
	map: 21,
    htmlElementId : "#total_count",
    executeAtStart: false,
	customScript: function(data)
	{
		 // console.log(data[0].count);	
         $('#total_count').html("<div><h4 style='color:black;'>Total Records Processed : "+data[0].count+"</h4></div>");
	}
};

var selectClientAttr = {
    name: "selectClientAttr",
    type:  "select2",
    parameters : ["cdisplay"],
    options:{
        multiple : true,
        value : 'cdisplay',
        display : 'clientattr',
    },
    htmlElementId : "#clientAttrPopup",
    executeAtStart: true,
    map:16
};

var selectClientAttrAll = {
    name: "selectClientAttrAll",
    type:  "select2",
    parameters : ["cdisplay_all"],
    options:{
        multiple:true,
        value : 'cdisplay_all',
        display : 'clientattr',
    },
    htmlElementId : "#clientAttrPopup_all",
    executeAtStart: true,
    map:17
};

var getClientAttr = {
    name: "getClientAttr",
    type: "custom",
    listeners: ["cdisplay"],
    htmlElementId: "#custom_dummytag",
    customScript: function(a,b) {
        //console.log('----- Executing custom script ---- run_now = ' + dashboard.getVariable('run_now'));
        var a = dashboard.getVariable('cdisplay');
			if (a.indexOf("ALL") > -1)
			{
			  a = ["`Client Key`","`First Name`","`Last Name`","`Date Of Birth`","Gender","Race","Ethnicity","`Veteran Status`","`Project Entry Date`","`Project Exit Date`","`Entering User Key`"];      // alert('all is selected');
			}
			else 
			{
			  a = dashboard.getVariable('cdisplay');
			}
			Dashboard.setVariable('cdisplay_org',a);
			//alert(Rkey);
    },
    executeAtStart: false
};

var drillDynaTable = {
    name: "drillDynaTable",
    type:"chart",
    requestParameters :{
        rowHeader : "rowHeader",
        Akey : "Akey",
        PKey : "PKey",
		colHeader : "colHeader",
		cdisplay_org : "cdisplay_org",
        sDate : "sDate",
        eDate : "eDate",
		CODE_KEY : "CODE_KEY",
		coc : "coc"
    },
    map:20,
    htmlElementId : "#drill",
    executeAtStart: false,
	customScript: function(data)
	{
		var drillDown = dashboard.setVariable('drillDown','true');
            var data2 = [];
        for(var i = 0; i< data.length; i++){
          var temp={};
          for (var key in data[i]){
            if( data[i].hasOwnProperty(key)){
               temp[key.toLowerCase()] = data[i][key];
            }
          }
     data2.push(temp);
       }
  
		  data = data2;
		  delete data2;
		  console.log(data);

			$("#drill").addClass('panel').addClass('panel-primary');

		var table = $('<table id="chart_5_table" class="table table-bordered table-striped"><thead><tr></tr></thead><tbody></tbody></table>');

		for (key in data[0]){
			table.find('thead tr').append('<th>' + key + '</th>');
		}

		/*$('#chart_5').append('<h3 class="panel-heading" style="margin-top:0; clear: none">Detailed Sales Report</h3>')                    */

		$('#drill').append(table);

		var dynatable = $('#chart_5_table').dynatable({
		  table :{
			defaultColumnIdStyle : 'lowercase'
		  },
		  dataset: {
			records: data
		  }
		}).data('dynatable');



	}
};

var getClientAttr_all = {
    name: "getClientAttr_all",
    type: "custom",
    listeners: ["cdisplay_all"],
    htmlElementId: "#custom_dummytag",
    customScript: function(a,b) {
        //console.log('----- Executing custom script ---- run_now = ' + dashboard.getVariable('run_now'));
        var a = dashboard.getVariable('cdisplay_all');
			if (a.indexOf("ALL") > -1)
			{
			  a = ["`Client Key`","`First Name`","`Last Name`","`Date Of Birth`","Gender","Race","Ethnicity","`Veteran Status`","`Project Entry Date`","`Project Exit Date`","`Entering User Key`"];      // alert('all is selected');
			}
			else 
			{
			  a = dashboard.getVariable('cdisplay_all');
			}
			Dashboard.setVariable('cdisplay_org_all',a);
			//alert(Rkey);
    },
    executeAtStart: false
};

<!-- another drill down component added -->
var drillDynaTableAll = {
    name: "drillDynaTableAll",
    type:"chart",
    requestParameters :{
		dataelements : "dataelements",
		Akey : "Akey",
        PKey : "PKey",
		result_option : "result_option",
		cdisplay_org_all : "cdisplay_org_all",
        sDate : "sDate",
        eDate : "eDate",
		CODE_KEY : "CODE_KEY",
		coc : "coc"
    },
    map:18,
    htmlElementId : "#wrap3",
    executeAtStart: false,
	customScript: function(data)
	{
		var drillDown_all = dashboard.setVariable('drillDown_all','true');
		var drillDown = dashboard.setVariable('drillDown','false');
            var data2 = [];
        for(var i = 0; i< data.length; i++){
          var temp={};
          for (var key in data[i]){
            if( data[i].hasOwnProperty(key)){
               temp[key.toLowerCase()] = data[i][key];
            }
          }
     data2.push(temp);
       }
  
		  data = data2;
		  delete data2;
		  console.log(data);

			$("#wrap3").addClass('panel').addClass('panel-primary');

		var table = $('<table id="chart_5_table" class="table table-bordered table-striped"><thead><tr></tr></thead><tbody></tbody></table>');

		for (key in data[0]){
			table.find('thead tr').append('<th>' + key + '</th>');
		}

		/*$('#chart_5').append('<h3 class="panel-heading" style="margin-top:0; clear: none">Detailed Sales Report</h3>')                    */

		$('#wrap3').append(table);

		var dynatable = $('#chart_5_table').dynatable({
		  table :{
			defaultColumnIdStyle : 'lowercase'
		  },
		  dataset: {
			records: data
		  }
		}).data('dynatable');



	}
};

<!-- end of another drill down table-->

var button = {
    name: "button",
    type:  "button",
    options: {
        display : "Run",
        classes: "btn-success btn-block btn-pcni"
    },
    htmlElementId: "#run",
    executeAtStart: false
};

var drillButton ={
    name: "drillButton",
    type:  "button",
    options: {
        display : "Run",
        classes: "btn-success btn-block btn-pcni"
    },
    htmlElementId: "#runDrillDown",
    executeAtStart: false
};

var drillButtonAll ={
    name: "drillButtonAll",
    type:  "button",
    options: {
        display : "Run",
        classes: "btn-success btn-block btn-pcni"
    },
    htmlElementId: "#runDrillDown_all",
    executeAtStart: false
};

var drillButtonSave ={
    name: "drillButtonSave",
    type:  "button",
    options: {
        display : "Save",
        classes: "btn-success btn-block btn-pcni"
    },
    htmlElementId: "#saveDrillDown",
    executeAtStart: false
};

var datepicker1 ={
    name: "datepicker",
    type:  "datepicker",
	options : {
 	displayFormat:"MM-DD-YYYY"},
    parameters: ["sDate"],
    htmlElementId: "#startDate",
    executeAtStart: true
};

var datepicker2 ={
    name: "datepicker2",
    type:  "datepicker",
	options : {
 	displayFormat:"MM-DD-YYYY"},
    parameters: ["eDate"],
    htmlElementId: "#endDate",
    executeAtStart: true
};

var scheduleSDate ={
    name: "scheduleSDate",
    type:  "datepicker",
    parameters: ["scheduleSDate"],
    htmlElementId: "#schedulesDate",
    executeAtStart: true
};

var scheduleEDate ={
    name: "scheduleEDate",
    type:  "datepicker",
    parameters: ["scheduleEDate"],
    htmlElementId: "#scheduleeDate",
    executeAtStart: true
};

var modal_save ={
    name: "modal_save",
    type:  "button",
    options: {
        display : "Save",
        classes: "btn-success btn-block btn-pcni"
    },
    htmlElementId: "#modal_submit",
    executeAtStart: false
};

var chart1 = {
    name: "chart1",
    type:"chart",
    listeners:[],
    requestParameters :{
        Akey: "Akey",
        PKey : "PKey",
		CODE_KEY:"CODE_KEY",
		coc:"coc",
		dataelements : "dataelements",
        result_option : "result_option",
        sDate : "sDate",
        eDate : "eDate"
    },
    map:19,
    htmlElementId : "#wrap2",
    executeAtStart: false,
    options:{
        actions :[{
            convertToBar:"Convert to Bar",
            convertToLine:"Convert to Line",
            convertToArea:"Convert to Area",
            convertToSpline:"Convert to Spline",
            convertToAreaSpline:"Convert to AreaSpline",
            convertToStep:"Convert to Step",
            convertToAreaStep:"Convert to AreaStep",
            convertToPie:"Convert to Pie",
            convertToDonut:"Convert to Donut",
            convertToScatter:"Convert to Scatter"
        }]
    },
	customScript: function(data)
	{
		if(_.pluck(data, 'one')==1)
			{
					$('#wrap2').html("<div style='border:1px solid;'><h2 style='text-align:CENTER;color:#927333;'>No Data To Display</h2></div>");
					return;
		
			}
		else {
			var drillDown = dashboard.setVariable('drillDown','false');
            var resultoptions = dashboard.getVariable('RESULTOPTIONS');
            $("#dynatable-processing-chart_4_table").remove();
			//$("#wrap2 .chart").empty();
			$('#getAllInfo').hide();
            for (var i in resultoptions) {
                var divtag = "<div id=\"C3Chart_" + i +"\"></div>"  
                //alert(resultoptions[i] + divtag);
                
                $("#wrap2").append(divtag);
       
                //data[0].Missing = 3;                                                                      
       
                var options = { 
                    type: 'C3BarChart',
                    data: { 
                        jsondata: data,
                        categorykey : 'dataelements',   
                        //serieskey: 'RESULTOPTIONS',
                        //valuekey: 'Refused',
                        valuekeys: [resultoptions[i]],
                        labels: true
                    },
                    placeholder: 'C3Chart_' + i,
                    point: {
                        show: true
                    },
                    tooltip: {
                        show: true
                    },
                    color: {
                            pattern: ['#c0c0c0', '#aec7e8', '#9467bd', '#c5b0d5', '#8c564b', '#c49c94', '#e377c2', '#f7b6d2', '#7f7f7f', '#c7c7c7', '#bcbd22', '#dbdb8d', '#17becf', '#9edae5']
                        },
                    zoom: {enabled:false},
                    subchart: {
                        show:false
                    },
                    legend: {
                            show: true,
                        },
                    axis: { rotated: true,
                        x: { 
                            label: {    
                                text: 'dataelements',
                                position: 'inner-right'
                            },
                            tick: { rotate:0 },
                            type: 'category',   
                        },
                        y: { 
                            label: {    
                                text: resultoptions[i]
                            }                               
                        }
                    },
                    interaction: {
                      enabled: true
                    }               
                };  
                var mychart = chart.renderChart(options);
                var baseChart = dashboard.getVariable('baseChart');
                baseChart.push(mychart);
                dashboard.setVariable('baseChart',baseChart);
                console.log(dashboard.getVariable('baseChart'));
            }
		}
	}
};

var showReportMetaData = function() {
    $('#runDate').text(moment().format("MM-DD-YYYY"));
    $('#runBy').text(window.DashboardGlobals.sessionUserName);
    var sDate = moment(Dashboard.getVariable('sDate'), 'YYYY-MM-DD').format("MM-DD-YYYY");
    var eDate = moment(Dashboard.getVariable('eDate'), 'YYYY-MM-DD').format("MM-DD-YYYY");
    $('#reportingPeriod').text( sDate+" - "+eDate);

    var projectList = $('#projectSelector').find('ul').empty();

    $('#projectSelector').off();

    if(projectNames){
		
        Dashboard.setVariable('projectNames', projectNames);
      }
    var projects = Dashboard.getVariable('projectNames');
        for (var i = 0; i < projects.length; i++){
			console.log(projects.length);
            projectList.append("<li>" + projects[i] + "</li>");
        }

        $('#projectSelector').on('click', 'a', function(){
            window.bootbox.alert(projects.join("<br>"));
            return false;
        })

};

var runScript = {
    name: "runScript",
    type: "custom",
    listeners: ["run_now"],
    htmlElementId: "#custom_dummytag",
    customScript: function(a,b) {
        //console.log('----- Executing custom script ---- run_now = ' + dashboard.getVariable('run_now'));
        if(dashboard.getVariable('run_now') == 'true'){
            $('#tb-convert-to-charts').removeClass('disabled');
            dashboard.setVariable('run_now','false');
            $('#main-report').removeClass('hidden');
            $('#drilldown-report').addClass('hidden');
			$('#drilldown-report-all').addClass('hidden');
            $('#wrap').hide();
            $('#wrap1').show();
			$('#wrap3').hide();
            Dashboard.updateComponent('dynaTable');
			//getTable("normal");
            $('#toolbar').show();
            $('#drill').hide();
            $('#info').show();
            showReportMetaData();
        }
    },
    executeAtStart: false
};

var runScriptdrillDown = {
    name: "runScriptdrillDown",
    type: "custom",
    listeners: ["run_now_drillDown"],
    htmlElementId: "#custom_dummytag1",
    customScript: function(a,b){
        //console.log('----- Executing custom script ---- run_now_drillDown = ' + dashboard.getVariable('run_now_drillDown'));
        if(dashboard.getVariable('run_now_drillDown') == 'true') {
            dashboard.setVariable('run_now_drillDown','false');
            $('#main-report, #drilldown-report').removeClass('hidden');
            $('#wrap').hide();
            $('#clientAttr').modal('hide');
            $('#wrap1').hide();
			$('#getAllInfo').hide();
			$('#wrap3').hide();
            $('#drill').show();
            $('#info').show();
            showReportMetaData();
            $('#tb-convert-to-charts').addClass('disabled');
        }

        Dashboard.updateComponent('drillDynaTable');
		//getTable("drill");
        $('#toolbar').show();
        $('#tb-convert-to-charts').addClass('disabled');
        $('#pcni-sub-menu').find('.form-inline').addClass('hidden')
    },
    executeAtStart: false
 };

 var runScriptdrillDownAll = {
    name: "runScriptdrillDownAll",
    type: "custom",
    listeners: ["run_now_drillDown_all"],
    htmlElementId: "#custom_dummytag2",
    customScript: function(a,b){
        //console.log('----- Executing custom script ---- run_now_drillDown = ' + dashboard.getVariable('run_now_drillDown'));
        if(dashboard.getVariable('run_now_drillDown_all') == 'true') {
            dashboard.setVariable('run_now_drillDown_all','false');
            $('#main-report, #drilldown-report-all').removeClass('hidden');
            $('#wrap').hide();
            $('#clientAttr').modal('hide');
			$('#clientAttr_all').modal('hide');
            $('#wrap1').hide();
            $('#drill').hide();
            $('#info').show();
			$('#wrap3').show();
            showReportMetaData();
            $('#tb-convert-to-charts').addClass('disabled');
        }

        Dashboard.updateComponent('drillDynaTableAll');
		//getTable("drill");
        $('#toolbar').show();
        $('#tb-convert-to-charts').addClass('disabled');
        $('#pcni-sub-menu').find('.form-inline').addClass('hidden')
    },
    executeAtStart: false
 };
 
var saveProjects = {
    name: "saveProjects",
    type: "custom",
    listeners: ["PKey"],
    htmlElementId: "#custom_dummytag",
    customScript: function() {
            projects = $('#project').find('input').select2('data');
            Dashboard.setVariable('projectNames', _.pluck(projects, 'text'))

    },
    executeAtStart: true
};
 
 var components = [selectProjectName,selectAgencyName,selectProjType,selectClientLoc,selectDataElementsGroups,selectDataElements,selectResultOption,getResultOption,dynaTable,modal_save,total_count,datepicker1,datepicker2,button,scheduleSDate,scheduleEDate,runScript,selectClientAttr,selectClientAttrAll,drillButton,getClientAttr,drillDynaTable,getClientAttr_all,drillDynaTableAll,chart1,drillButtonSave,runScriptdrillDown,runScriptdrillDownAll,drillButtonAll,saveProjects];
 
 /*var components = [selectAgencyName,selectProjectName,selectProjType,datepicker1,datepicker2,selectClientLoc,selectDataElementsGroups,selectDataElements,selectResultOption,button];*/

dashboard.init(components);

//run_now variable
var t = "${run_now}";

if(t.indexOf("{run_now}") >= 0){
  dashboard.setVariable('run_now','false');
} else {
  dashboard.setVariable('run_now',t.replace(/'/g,''));
}

var t1 = "${run_now_drillDown}";

if(t1.indexOf("{run_now_drillDown}") >= 0){
  dashboard.setVariable('run_now_drillDown','false');
} else {
  dashboard.setVariable('run_now_drillDown',t1.replace(/'/g,''));
}

var t2 = "${run_now_drillDown_all}";

if(t2.indexOf("{run_now_drillDown_all}") >= 0){
  dashboard.setVariable('run_now_drillDown_all','false');
 } else {
  dashboard.setVariable('run_now_drillDown_all',t2.replace(/'/g,''));
}

jQuery("#main").on('click','#convertToBar',function(event){
    event.preventDefault();
    Dashboard.resetComponent('chart1');
    var baseCharts = Dashboard.getVariable('baseChart');
    var newCharts = [];
    for(var i in baseCharts){
        newCharts.push(baseCharts[i].transform('C3BarChart'));
    }
    Dashboard.setVariable('baseChart',newCharts);
});

jQuery("#main").on('click','#convertToLine',function(event){
    event.preventDefault();

    Dashboard.resetComponent('chart1');

    var baseCharts = Dashboard.getVariable('baseChart');
    var newCharts = [];
    for(var i in baseCharts){
        newCharts.push(baseCharts[i].transform('C3LineChart'));
    }
    Dashboard.setVariable('baseChart',newCharts);
});

jQuery("#main").on('click','#convertToArea',function(event){
    event.preventDefault();
    Dashboard.resetComponent('chart1');
    var baseCharts = Dashboard.getVariable('baseChart');
    var newCharts = [];
    for(var i in baseCharts){
        newCharts.push(baseCharts[i].transform('C3AreaChart'));
    }
    Dashboard.setVariable('baseChart',newCharts);
});

jQuery("#main").on('click','#convertToSpline',function(event){
    event.preventDefault();
    Dashboard.resetComponent('chart1');
    var baseCharts = Dashboard.getVariable('baseChart');
    var newCharts = [];
    for(var i in baseCharts){
        newCharts.push(baseCharts[i].transform('C3SplineChart'));
    }
    Dashboard.setVariable('baseChart',newCharts);
});

jQuery("#main").on('click','#convertToAreaSpline',function(event){
    event.preventDefault();
    Dashboard.resetComponent('chart1');
    var baseCharts = Dashboard.getVariable('baseChart');
    var newCharts = [];
    for(var i in baseCharts){
        newCharts.push(baseCharts[i].transform('C3AreaSplineChart'));
    }
    Dashboard.setVariable('baseChart',newCharts);

});

jQuery("#main").on('click','#convertToScatter',function(event){
    event.preventDefault();
    Dashboard.resetComponent('chart1');
    var baseCharts = Dashboard.getVariable('baseChart');
    var newCharts = [];
    for(var i in baseCharts){
        newCharts.push(baseCharts[i].transform('C3ScatterChart'));
    }
    Dashboard.setVariable('baseChart',newCharts);

});

jQuery("#main").on('click','#convertToStep',function(event){
    event.preventDefault();
    Dashboard.resetComponent('chart1');
    var baseCharts = Dashboard.getVariable('baseChart');
    var newCharts = [];
    for(var i in baseCharts){
        newCharts.push(baseCharts[i].transform('C3StepChart'));
    }
    Dashboard.setVariable('baseChart',newCharts);
});

jQuery("#main").on('click','#convertToAreaStep',function(event){
    event.preventDefault();
    Dashboard.resetComponent('chart1');
    var baseCharts = Dashboard.getVariable('baseChart');
    var newCharts = [];
    for(var i in baseCharts){
        newCharts.push(baseCharts[i].transform('C3AreaStepChart'));
    }
    Dashboard.setVariable('baseChart',newCharts);
});

jQuery("#main").on('click','#convertToPie',function(event){
    event.preventDefault();
    Dashboard.resetComponent('chart1');
    var baseCharts = Dashboard.getVariable('baseChart');
    var newCharts = [];
    for(var i in baseCharts){
        newCharts.push(baseCharts[i].transform('C3PieChart'));
    }
    Dashboard.setVariable('baseChart',newCharts);
});

jQuery("#main").on('click','#convertToDonut',function(event){
    event.preventDefault();
    Dashboard.resetComponent('chart1');
    var baseCharts = Dashboard.getVariable('baseChart');
    var newCharts = [];
    for(var i in baseCharts){
        newCharts.push(baseCharts[i].transform('C3DonutChart'));
    }
    Dashboard.setVariable('baseChart',newCharts);
});

$(document).ready(function(){
		
    $('#pcni-sub-menu').find('.form-inline').addClass('hidden');
    if(window.DashboardGlobals.fileIsFavourite)
        {
            $('#favSelection').removeClass('fa fa-star-o');
            $('#favSelection').addClass('fa fa-star');
        }
    //$('#back').hide();
    $('#wrap2').hide();
	//$('#total_count').hide();

	//$(".edit_description").attr('maxlength','5');
	
    $("#run").click(function(e) {
	    dashboard.setVariable('run_now','true');
		$("#total_count").show();
	   //getChart();
        return false;
    });
	
	$("#back").on('click', 'a',function(e) {
        $('#main-report, #drilldown-report, #drilldown-report-all').addClass('hidden');
        $('#wrap').show();
		$('#total_count').hide();
        $('#wrap1').hide();
        $('#toolbar').hide();
        $('#wrap2').hide();
		$('#wrap3').hide();
        $('#drill').hide();
        $('#page-title').html('New Report');
        dashboard.setVariable('drillDown','false');
        $('#info').hide();
        return false;
    });

    $("#main-report").on('click', 'a',function(e) {
        dashboard.setVariable('run_now','true');
        dashboard.setVariable('drillDown','false');
        dashboard.setVariable('run_now_drillDown','false');
		$('#getAllInfo').show();
		$('#total_count').show();
        return false;
    });

    $('#tb-export').on('click', 'a',function(e){
          //if($('#csv').is(':checked')){
        var format = $(this).data('format');
        if(format === 'csv'){
            if(dashboard.getVariable('drillDown') == 'true'){
                var dataToSend = {
                    cdisplay_org : Dashboard.getVariable('cdisplay_org'),
                    rowHeader : Dashboard.getVariable('rowHeader'),
                    colHeader : Dashboard.getVariable('colHeader'),
                    Akey : Dashboard.getVariable('Akey'),
                    PKey : Dashboard.getVariable('PKey'),
                    sDate : Dashboard.getVariable('sDate'),
                    eDate : Dashboard.getVariable('eDate'),
					CODE_KEY : Dashboard.getVariable('CODE_KEY'),
					coc : Dashboard.getVariable('coc'),
                    map:20,
                    dir: window.DashboardGlobals.folderpath
                }
				
            } else if(dashboard.getVariable('drillDown_all') == 'true'){
                var dataToSend = {
					dataelements : Dashboard.getVariable('dataelements'),
                    Akey : Dashboard.getVariable('Akey'),
                    PKey : Dashboard.getVariable('PKey'),
					result_option : Dashboard.getVariable('result_option'),
					cdisplay_org_all : Dashboard.getVariable('cdisplay_org_all'),
                    sDate : Dashboard.getVariable('sDate'),
                    eDate : Dashboard.getVariable('eDate'),
					CODE_KEY : Dashboard.getVariable('CODE_KEY'),
					coc : Dashboard.getVariable('coc'),
                    map:18,
                    dir: window.DashboardGlobals.folderpath
                }
				
            } 
			else {
                var dataToSend = { 
                    Akey:Dashboard.getVariable('Akey'),
                    PKey:Dashboard.getVariable('PKey'),
					CODE_KEY:Dashboard.getVariable('CODE_KEY'),
					coc:Dashboard.getVariable('coc'),
					dataelements:Dashboard.getVariable('dataelements'),
                    result_option:Dashboard.getVariable('result_option'),
                    sDate:Dashboard.getVariable('sDate'),
                    eDate:Dashboard.getVariable('eDate'),
                    DYNATABLE:Dashboard.getVariable('DYNATABLE'),
                    map:19,
                    dir: window.DashboardGlobals.folderpath
                 }
				
            }

            window.open(window.DashboardGlobals.exportData + '?data=' + JSON.stringify(dataToSend)+'&dir='+window.DashboardGlobals.folderpath+'&filename='+window.DashboardGlobals.file+'&reportType='+window.DashboardGlobals.extension+'&resultDirectory=/DataQualityReport/Saved Reports'+'&reportNameParam='+window.DashboardGlobals.fileTitle+'&reportName='+window.DashboardGlobals.fileTitle);
        }

        if(format === 'pdf') { $.getPrint('pdf'); }

        e.preventDefault();
    })

   $('#tb-print-pdf').click(function(e){
        window.print();
        e.preventDefault();
    })

   $('#scheduleReport').change(function() {
        var filename  = $('#save-report-name').closest('.form-group');
        var button = $('#emailing-btn').find('span');
        if($(this).is(':checked')) {
            filename.removeClass('hidden');
            button.text('Schedule Email');
            $('#scheduling-modal').modal('show');
            var jsonScheduleData = Dashboard.getVariable('scheduleopts');

            $('#scheduleButton').off().one('click', function() {
                var jsonScheduleData = $('#scheduling-form').serializeObject();
				// console.log('schedule option data : '+jsonScheduleData);
                Dashboard.setVariable('scheduleopts',jsonScheduleData);
                $('#scheduling-modal').modal('hide');
            });
        } else {
            filename.addClass('hidden');
            button.text('Email Now')
        }
    });

    $('#scheduling-modal').on('click', '.close', function(){ $('#scheduleReport').prop('checked', false).change();});

    $('#tb-email').on('click', function(e){
        $('#emailing-modal').modal('show').one('hidden.bs.modal', function(){
            $('#scheduleReport').prop('checked', false).change();
        });

        $('#emailing-btn').off().on('click', function(){
            var base, data, formats, recipients, reportSource, reportSourceType;

            if ($(this).parent('li').hasClass('disabled')) {
                return false;
            }

            if(!$('#email-csv').is(':checked') && !$('#email-pdf').is(':checked')){
                bootbox.alert('Please select at least one format');
                return false
            }

            base = "<base href=\"" + window.location.protocol + "//" + window.location.host + window.DashboardGlobals.baseUrl + "\">";


            var csvToSend = null;

            var emails = $('#email-to').val().split(';').filter(function(n){ return !!n;});
            var formats = [];

            if($('#email-pdf').is(':checked')){
                formats.push('pdf');
                data = $('html').clone().find('script')
                    .remove().end().find('nav').remove()
                    .end().find('#dashboardCanvas')
                    .removeClass('dashboardCanvas')
                    .end().find('head').prepend(base).end().html();

                data = encodeURIComponent(Base64.encode('<html>' + data + '</html>'));
            }
			var mapId;
            if($('#email-csv').is(':checked')){
                formats.push('csv');
                if(dashboard.getVariable('drillDown') == 'true'){
                    var csvToSend = {
                        cdisplay_org : Dashboard.getVariable('cdisplay_org'),
                        rowHeader : Dashboard.getVariable('rowHeader'),
                        colHeader : Dashboard.getVariable('colHeader'),
                        Akey : Dashboard.getVariable('Akey'),
                        PKey : Dashboard.getVariable('PKey'),
                        sDate : Dashboard.getVariable('sDate'),
                        eDate : Dashboard.getVariable('eDate'),
						CODE_KEY : Dashboard.getVariable('CODE_KEY'),
						coc : Dashboard.getVariable('coc'),
                        map:20,
                        dir: window.DashboardGlobals.folderpath
                    }
					
                } else if(dashboard.getVariable('drillDown_all') == 'true'){
					var csvToSend = {
					dataelements : Dashboard.getVariable('dataelements'),
                    Akey : Dashboard.getVariable('Akey'),
                    PKey : Dashboard.getVariable('PKey'),
					result_option : Dashboard.getVariable('result_option'),
					cdisplay_org_all : Dashboard.getVariable('cdisplay_org_all'),
                    sDate : Dashboard.getVariable('sDate'),
                    eDate : Dashboard.getVariable('eDate'),
					CODE_KEY : Dashboard.getVariable('CODE_KEY'),
					coc : Dashboard.getVariable('coc'),
                    map:18,
                    dir: window.DashboardGlobals.folderpath
                }
				
            }  
				else {
                    var csvToSend = {    
                        Akey:Dashboard.getVariable('Akey'),
                        PKey:Dashboard.getVariable('PKey'),
						CODE_KEY:Dashboard.getVariable('CODE_KEY'),
						coc:Dashboard.getVariable('coc'),
						dataelements:Dashboard.getVariable('dataelements'),
                        result_option:Dashboard.getVariable('result_option'),
                        sDate:Dashboard.getVariable('sDate'),
                        eDate:Dashboard.getVariable('eDate'),
                        DYNATABLE:Dashboard.getVariable('DYNATABLE'),
                        map:19,
                        dir: window.DashboardGlobals.folderpath
                     }
					
                }
                csvToSend = JSON.stringify(csvToSend)
            }

            if($('#scheduleReport').is(':checked')){
                if($('#save-report-name').val().trim()==''){
                    dashboard.modal('Error','Please provide report name');
                    return false;
                }
                var scheduleopts = dashboard.getVariable('scheduleopts');
                scheduleopts.ScheduledTime = "15:06:00";
				var reportDesc = $('#reportDesc').val();
				//console.log("inside schedule : "+JSON.stringify(scheduleopts));

                var subject = $('#email-subject').val(),
                    body = $('#email-body').val();

                var emailSettings = {
                    Formats: formats,
                    Recipients: JSON.stringify(emails),
                    Zip: false
                }

                if(subject && subject !== '') {
                    emailSettings.Subject = subject;
                }

                if(body && body !== '') {
                    emailSettings.Body = body;
                }

                var parameters = {
                    dataelements:Dashboard.getVariable('dataelements'),
                    result_option:Dashboard.getVariable('result_option'),
                    Akey:Dashboard.getVariable('Akey'),
                    PKey:Dashboard.getVariable('PKey'),
                    sDate:Dashboard.getVariable('sDate'),
                    eDate:Dashboard.getVariable('eDate'),
					CODE_KEY:Dashboard.getVariable('CODE_KEY'),
					coc:Dashboard.getVariable('coc'),
                    run_now:'true',
                    format:Dashboard.getVariable('format'),
                    projectParam:Dashboard.getVariable('projectParam'),
                    projectNames: Dashboard.getVariable('projectNames')
                };

                var postJSON = {
                    command:'add',
                    reportName:$('#save-report-name').val(),
                    reportDirectory:window.DashboardGlobals.folderpath,
                    reportFile:window.DashboardGlobals.file,
                    location:"DataQualityReport/My Library/Report Templates - Data Quality",
                    EmailSettings: JSON.stringify(emailSettings),
                    ScheduleOptions: JSON.stringify(scheduleopts),
					reportDesc: reportDesc,
                    isActive: true
                };

                if (csvToSend) {
                    parameters.csvdata = csvToSend;
                }
                postJSON.reportParameters=JSON.stringify(parameters);

                $.post(window.DashboardGlobals.saveReport, postJSON).done(function( data ) {

                    if(data == 'success')
                        dashboard.modal('Success','Your report has been saved sucessfully');
                    else
                        dashboard.modal('Error','There is some problem in saving your report. Please try again');
                });
                $('#emailing-modal').modal('hide');

            } else {
                $('#emailing-modal').modal('hide');
                var subject = $('#email-subject').val(),
                    body = $('#email-body').val(),
                    emailsettings = {
                        formats: JSON.stringify(formats),
                        recipients: JSON.stringify(emails),
                        reportSourceType: 'adhoc',
                        reportName: 'DataQualityApp',
                        data: csvToSend
					};
                    emailsettings.reportSource = data ? data : '';

                if(subject && subject !== '') {
                    emailsettings.subject = subject;
                }

                if(body && body !== '') {
                    emailsettings.body = body;
                }

                $.post(window.DashboardGlobals.sendMail, emailsettings).done(function( data ) {
                    if(data == 'success')
                        dashboard.info('Your email has been sent sucessfully');
                    else
                        dashboard.alert('There is some problem in sending your email. Please try again');
                });
            }

        });
        e.preventDefault();
    });

    $('#tb-save').click(function(e){

        //var reportName = false;
		//var reportDescription = "for test";

        /*bootbox.prompt('Please give a name for your report', function(result){
            if (result === null || result === ''){

            } else {
                    var parameters = {
                        dataelements:Dashboard.getVariable('dataelements'),
                        result_option:Dashboard.getVariable('result_option'),
                        Akey:Dashboard.getVariable('Akey'),
                        PKey:Dashboard.getVariable('PKey'),
                        sDate:Dashboard.getVariable('sDate'),
                        eDate:Dashboard.getVariable('eDate'),
						CODE_KEY:Dashboard.getVariable('CODE_KEY'),
						coc:Dashboard.getVariable('coc'),
                        run_now:'true',
                        projectParam:Dashboard.getVariable('projectParam'),
                        projectNames: Dashboard.getVariable('projectNames')
                    };

                if(dashboard.getVariable('drillDown') ==='true') {
                        parameters.cdisplay_org = Dashboard.getVariable('cdisplay_org');
                        parameters.rowHeader = Dashboard.getVariable('rowHeader');
                        parameters.colHeader = Dashboard.getVariable('colHeader');
                        parameters.run_now_drillDown ='true';
                }
				
				if(dashboard.getVariable('drillDown_all') ==='true') {
                        parameters.cdisplay_org_all = Dashboard.getVariable('cdisplay_org_all');
                        parameters.run_now_drillDown_all ='true';
                }

                var postJSON = {
                    command:'add',
                    reportName: result,
                    reportDirectory:window.DashboardGlobals.folderpath,
                    reportFile:window.DashboardGlobals.file,
					reportDesc:reportDescription,
                    location:"DataQualityReport/My Library/Report Templates - Data Quality",
                };

                postJSON.reportParameters=JSON.stringify(parameters);

                $.post(window.DashboardGlobals.saveReport, postJSON).done(function( data ) {

                    if(data == 'success')
                        dashboard.modal('Success','Your report has been saved sucessfully');
                    else
                        dashboard.modal('Error','There is some problem in saving your report. Please try again');
                });
            }
        });*/
		$('#saveModal').modal('show');
		$('#modal_submit').click(function(result) {
			$('#saveModal').modal('hide');
			var reportName = $('#nameReport').val();
			var reportDescription = $('#descReport').val();
			 if (result === null || result === ''){

            }else {
			var parameters = {
                        dataelements:Dashboard.getVariable('dataelements'),
                        result_option:Dashboard.getVariable('result_option'),
                        Akey:Dashboard.getVariable('Akey'),
                        PKey:Dashboard.getVariable('PKey'),
                        sDate:Dashboard.getVariable('sDate'),
                        eDate:Dashboard.getVariable('eDate'),
						CODE_KEY:Dashboard.getVariable('CODE_KEY'),
						coc:Dashboard.getVariable('coc'),
                        run_now:'true',
                        projectParam:Dashboard.getVariable('projectParam'),
                        projectNames: Dashboard.getVariable('projectNames')
                    };

                if(dashboard.getVariable('drillDown') ==='true') {
                        parameters.cdisplay_org = Dashboard.getVariable('cdisplay_org');
                        parameters.rowHeader = Dashboard.getVariable('rowHeader');
                        parameters.colHeader = Dashboard.getVariable('colHeader');
                        parameters.run_now_drillDown ='true';
                }
				
				if(dashboard.getVariable('drillDown_all') ==='true') {
                        parameters.cdisplay_org_all = Dashboard.getVariable('cdisplay_org_all');
                        parameters.run_now_drillDown_all ='true';
                }

                var postJSON = {
                    command:'add',
                    reportName: reportName,
                    reportDirectory:window.DashboardGlobals.folderpath,
                    reportFile:window.DashboardGlobals.file,
					reportDesc:reportDescription,
                    location:"DataQualityReport/My Library/Report Templates - Data Quality",
                };

                postJSON.reportParameters=JSON.stringify(parameters);

                $.post(window.DashboardGlobals.saveReport, postJSON).done(function( data ) {

                    if(data == 'success')
                        dashboard.modal('Success','Your report has been saved sucessfully');
                    else
                        dashboard.modal('Error','There is some problem in saving your report. Please try again');
                });
			}
		});
        e.preventDefault();
    });
	
	$('#tb-convert-to-charts').click(function(e) {

        if ($(this).hasClass('disabled')) return false;

        if($('#wrap1').css("display")=='block')
        {
            Dashboard.updateComponent('chart1');
			
			//getChart();
			
        }
        $('#wrap1').toggle();
        $('#wrap2').toggle();
        e.preventDefault();
        return false;
    });

    $('#runDrillDown').click(function() {
        dashboard.setVariable('run_now_drillDown','true');
		$("#total_count").hide();
   });
   
   $('#getAllInfo').click(function() {
		//dashboard.setVariable('run_now_drillDown_all','true');
		$("#selectClientAttr").removeClass('hidden');
		$('#clientAttr_all').modal('show');
	});
   
	$('#runDrillDown_all').click(function() {
		dashboard.setVariable('run_now_drillDown_all','true');
		$("#total_count").hide();
	});
	 
    return false;
});

</script>
